<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, maximum-scale=1.2" >
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Food Car</title>
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/bootstrap.css">
  <!-- <link rel="stylesheet" href="font-awesome/css/font-awesome.css"> -->
  <!-- =======jQuery載入========================================= -->
  <script src="js/jquery.min.js"></script>
  <script type="text/javascript" src="{{ mix('js/checksessionexpire.js') }}"></script>
  <script type="text/javascript" src="{{ mix('js/jquery.shop_food.js') }}"></script>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Exo+2:600,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-124756195-1', 'auto');
    ga('send', 'pageview', location.pathname);
    </script>

</head>
<body>
  <div class='header'>
    <div class="container justify-content-center">
      <p></p>
      <!-- 美食車 -->
    </div>    
  </div>
<div class='wrapper'>   
<!-- Start banner -->
    <div class="banner">
      <div class='location'>
        <div class='weekday'>取餐點</div>
      <div class="dropdown">
        <button class="dropdown-toggle wordlong" type="button" id="dropdownLocationButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src='img/pin.png'>新竹智邦餐廳<i class="sidebar-icon fa fa-angle-down"></i></button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item location_select" >新竹智邦餐廳</a>
          <a class="dropdown-item location_select" >新邦餐廳</a>
          <a class="dropdown-item location_select" >新竹智廳</a>
        </div>
      </div>
      </div>
    </div>
<!-- End banner -->

<!-- Start navbar -->
  <nav class="navbar navbar-fixed-top" id="desktop-nav">
      <ul class= "showDate">
        <li>
          <a href="#d1224" class="page-scroll">
            <div>
              <div class='weekday'>週ㄧ</div>
              <div class='date'>24</div>
            </div>
          </a>
        </li>
        <li><a href="#d1225" class="page-scroll"><div class='weekday'>週二</div><div class='date'>25</div></a></li>
        <li><a href="#d1226" class="page-scroll"><div class='weekday'>週三</div><div class='date'>26</div></a></li>
        <li class="active">
          <a href="#d1227" class="page-scroll">
            <div class="row">
<!--                <div class="col-3 col-md-3 no-padding">
                  訂購時段
              </div>    -->           
              <div class="col-1 col-md-1 no-padding">
                <div class='weekday'>週四</div>
                <div class='date'>27</div>
              </div>            
              <div class="col-10 col-md-10 no-padding meal">
                <div class="mealicon">  
                  <img src='img/lunchbox.png'/> 
                  <span>午餐</span>
                  </div>
                <div class='shopstatus'>訂購中 09:00am截止</div>
                <div class='shoptime'></div>
              </div>              
            </div>
            </a>
          </li>
        <li><a href="#d1228" class="page-scroll"><div class='weekday'>週五</div><div class='date'>28</div></a></li>
      </ul>
      <a class="menu-link" href="#menu"></a>
      <a class='order'></a>
      <!-- <a class="menu-link" href="#menu"></a> -->
      <ul class= "ddwn">
        <li><a href="#d1224" class="ddwnMenu"><div class='weekday'>週一</div><div class='date'>24</div><div class='check'></div></a></li> 
        <li><a href="#d1225" class="ddwnMenu"><div class='weekday'>週二</div><div class='date'>25</div><div class='check'></div></a></li>
        <li><a href="#d1226" class="ddwnMenu"><div class='weekday'>週三</div><div class='date'>26</div><div class='check'></div></a></li>
        <li><a href="#d1227" class="ddwnMenu"><div class='weekday'>週四</div><div class='date'>27</div><div class='check'></div></a></li>
        <li><a href="#d1228" class="ddwnMenu"><div class='weekday'>週五</div><div class='date'>28</div><div class='check'></div></a></li>
      </ul>
  </nav>

<!--  <div class="bump">&nbsp;</div>   -->  
  <div class='weeklyMenu'>  
    <section id="d1224">24</section>
    <section id="d1225">25</section>     
    <section id="d1226">26</section>
    <section id="d1227">27</section>
    <section id="d1228">28</section>
    <section id="end">到底囉</section>
  </div>
</div>      
</body>
<script src="js/bootstrap.bundle.min.js" type="text/javascript"></script>

<script>
$(document).ready(function(){
  $('body').css('opacity','0');

});
$(window).load(function(){

});

jQuery(function($){
  $("#desktop-nav").menuScroll();
});

// COPY THE FOLLOWING FUNCTION INTO ANY SCRIPTS
jQuery.fn.extend({
    menuScroll: function() {
    // Declare all global variables
    var topMenu = this;
    var topMenuHeight = $(topMenu).outerHeight();
    var headerHeight= $('.header').height();  
    var bannerHeight= $('.banner').height();
    var menuItems = $(topMenu).find("a.page-scroll");
    
    var lastId;
    var initId=$(topMenu).find(".active a").attr('href'); 
    var status='init';    
    var click= false;
    var firstTouch=false; 
    var trigger; 
    var w=$('.menu-link').outerWidth();
  
    $('.ddwnMenu').filter("[href='"+initId+"']").find('.check').css({'visibility':'visible'});
    $('.order').css({'right':w+2});

    $('.weeklyMenu').css({'top':topMenuHeight+headerHeight+bannerHeight});
    var target_top = $(initId).offset().top;
    var firstScrollTop=target_top-topMenuHeight-headerHeight-bannerHeight;    
    $("html,body").animate({'scrollTop':firstScrollTop},300);
    status='firstScrollDone'; 

    var tempScrollTop=$("body").scrollTop();
    console.log('target_top '+target_top+" "+firstScrollTop);

    var stickyOffset=$('.location').position().top+headerHeight-topMenuHeight;

        var nm = $("html").scrollTop();
        var nw = $("body").scrollTop();

        console.log(nm+" "+nw);

    // Save all menu items into scrollItems array
        scrollItems = $(menuItems).map(function() {
            var item = $($(this).attr("href"));

            if (item.length) {
                return item;
            }
        });

        index=$(menuItems).index($(initId));


        //
    $("body").on("touchstart", function(e) {         
        // 判斷默認行為是否可以被禁用
        // if (e.cancelable) {
        //     // 判斷默認行為是否已經被禁用
        //     if (!e.defaultPrevented) {
        //         e.preventDefault();
        //     }
        // }
        if(!firstTouch){
        status='ready';
        console.log(status);
        firstTouch=true;
       }
    });

//
      $(topMenu).on("touchstart", "a.ddwnMenu", function(){

          trigger='ddwnMenu';
          click=true;

          var href = $(this).attr("href");
          
          $('.ddwnMenu').find('.check').css({'visibility':'hidden'});
          $(this).find('.check').css({'visibility':'visible'})

          if(status=='ready'){
          var offsetTop = href === "#" ? 0 : $(href).offset().top-$(href).parent().offset().top;
          console.log($(href).offset().top);

          }else if(status=='sticky'){
          var offsetTop = href === "#" ? 0 : $(href).offset().top-$(href).parent().offset().top;
          console.log($(href).offset().top);

          }

          $('html, body').stop().animate({ 
              scrollTop: offsetTop
          }, 300).promise().done(function(){
            console.log('click '+click);
            click=false;
          });
          //
          $navbar.removeClass('active'); 
          
          $(menuItems)
          .parent().removeClass("active")
          .end().filter("[href='"+href+"']").parent().addClass("active");
          console.log('href '+href+'  a');
      }); 

      $('.weeklyMenu').on("touchstart", function(){
          trigger='weeklyMenu';
      });   

//
      $(window).scroll(function(){

        if(trigger=='ddwnMenu'){

        }    
       if(trigger=='weeklyMenu'){

        var direction=$("body").scrollTop()-tempScrollTop>0?"down":"up";

        if(status=='ready'&&direction=='down'&& $("body").scrollTop()>firstScrollTop+10){
            //$("html,body").animate({'scrollTop':$("html,body").prop('scrollTop')-30},300);
            $('.banner').addClass( "temp" );
            $('.banner').css({'top':firstScrollTop+45});
            $('.location').addClass( "temp" );
            $('.location button').addClass( "disabled" );
            $('.navbar').addClass( "temp" );
            $('.navbar').css({'top':firstScrollTop+209});
            status='temp';
        }
        if(status=='ready'&&direction=='up'){

        }

        if(status=='temp'&&direction=='up'&& $("body").scrollTop()<firstScrollTop+45){
            $('.banner').removeClass( "temp" );
            $('.banner').css({'top':'45px'});
            $('.location').removeClass( "temp" );
            //$('.location button').addClass( "disabled" );
            $('.navbar').removeClass( "temp" );
            $('.navbar').css({'top':'209px'});
            status='ready';
            //console.log('來了'+ $("html,body").scrollTop()+" "+firstScrollTop);
        }           
      // if(status=='temp'&&direction=='down'&&$("html,body").scrollTop()-firstScrollTop>stickyOffset){
     //       // $("html,body").animate({'scrollTop':$("html,body").prop('scrollTop')-30},300);
     //       $('.banner').addClass( "sticky" ).removeClass('temp');
     //       $('.banner').css({'top':tempScrollTop+45});
     //       $('.location').addClass( "sticky" ).removeClass('temp');
     //       $('.location button').addClass( "disabled" );
     //       $('.navbar').addClass( "sticky" ).removeClass('temp');
     //       $('.navbar').css({'top':'75px'});
     //       $('.weeklyMenu').addClass('sticky');
     //       $('.weeklyMenu').css({'position':'absolute','top':'120px'});
     //       // $('.weeklyMenu').css({'top':headerHeight*-1});
     //       $("html,body").animate({'scrollTop':firstScrollTop},0);
     //       status='sticky';
     //     }
        if(status=='temp'&&direction=='down'&& $("body").scrollTop()-firstScrollTop>stickyOffset){
              // $("html,body").animate({'scrollTop':$("html,body").prop('scrollTop')-30},300);
              $('.banner').addClass( "sticky" ).removeClass('temp');
              //$('.banner').css({'top':tempScrollTop+45});
              $('.banner').css({'top':headerHeight});
              $('.location').addClass( "sticky" ).removeClass('temp');
              $('.location button').addClass( "disabled" );
              $('.navbar').addClass( "sticky" ).removeClass('temp');
              $('.navbar').css({'top':'75px'});
              $('.weeklyMenu').addClass('sticky');
              $('.weeklyMenu').css({'position':'absolute','top':'120px'});
              // $('.weeklyMenu').css({'top':headerHeight*-1});
              $("html,body").animate({'scrollTop':firstScrollTop},0);
              status='sticky';
        }         
      // if(status=='sticky'&&direction=='up'&&$("html,body").scrollTop()<5){
     //         $('.banner').addClass( "temp" ).removeClass('sticky');
     //       $('.banner').css({'top':tempScrollTop+45});
     //       $('.location').addClass( "temp" ).removeClass('sticky');
     //       $('.location button').addClass( "disabled" );
     //       $('.navbar').addClass( "temp" ).removeClass('sticky');
     //       $('.navbar').css({'top':'75px'});
     //       $('.weeklyMenu').removeClass('sticky');
     //       status='backtemp';      
      // }

        if(status=='sticky'&&direction=='up'&& $("body").scrollTop()<10){
              $('.banner').removeClass( "sticky" );
              $('.banner').css({'top':'45px'});
              $('.location').removeClass( "sticky" );
              $('.navbar').removeClass( "sticky" );
              $('.navbar').css({'top':'209px'});
              $('.weeklyMenu').css({'position':'absolute','top':headerHeight+$('.banner').height()+topMenuHeight});
              status='ready';
        }

        if(status=='temp'){

          $menulink.css({'opacity':'.2'});
             $(menuItems)
            .parent().removeClass("active")
            .end().filter("[href='"+initId+"']").parent().addClass("active");       
            console.log('b');
        } 

//
      if(status=='sticky'){
        $menulink.css({'opacity':'1'});
            var current = $(scrollItems).map(function(){          
               var result=$(window).scrollTop()-$(this).offset().top+headerHeight+topMenuHeight+$('.banner').height();
               if (result>=-20)
               return this;
           });

      // Get the most recent passed section from current array

            current = current[current.length-1];
            var id = current && current.length ? current[0].id : "";
  
            if (lastId !== id) {
                lastId = id;
                // Set/remove active class
                $(menuItems)
                .parent().removeClass("active")
                .end().filter("[href='#"+id+"']").parent().addClass("active");
                console.log('c');

                $('.ddwnMenu').find('.check').css({'visibility':'hidden'}).end().
                filter("[href='#"+id+"']").find('.check').css({'visibility':'visible'});                  
            }

        }


        // if(status=='ready' && click=='true'){
        //  $('.menu-link').css({'opacity':'1'});


        // }
        if(status=='ready'){
          $menulink.css({'opacity':'1'});
            var current = $(scrollItems).map(function(){          
               var result=$(window).scrollTop()+$(this).parent().offset().top-$(this).offset().top;
               if (result>=-20)
               return this;
               //console.log('ready '+$(this).offset().top+" "+$(window).scrollTop()+" "+$(this).parent().offset().top);
            });

      // Get the most recent passed section from current array

            current = current[current.length-1];
            var id = current && current.length ? current[0].id : "";
      //console.log('id '+current[0].id);

            if (lastId !== id) {
                lastId = id;
                // Set/remove active class
                $(menuItems)
                .parent().removeClass("active")
                .end().filter("[href='#"+id+"']").parent().addClass("active");
                console.log('d');

                $('.ddwnMenu').find('.check').css({'visibility':'hidden'}).end().
                filter("[href='#"+id+"']").find('.check').css({'visibility':'visible'});                
            }
        }
      }
      if($("body").scrollTop()<0){
             $(menuItems)
            .parent().removeClass("active")
            .end().first().parent().addClass("active");         
      }


      tempScrollTop=$("body").scrollTop();
      console.log(status+' nm '+nm+" "+$("body").scrollTop()+" "+firstScrollTop+" "+stickyOffset+" "+$('.header').css('z-index')+" "+click);
      $("p").text(status+" "+trigger+" "+$("body").scrollTop()+" "+firstScrollTop+"st "+stickyOffset+index); 
   });

var $navbar = $('.navbar'),
    $menulink = $('.menu-link');

    $navbar.click(function(){
      return false;
    })

    $menulink.click(function() {

      if(status=='temp'){ 
        
      }else{
        $navbar.toggleClass('active');
      } 
    });  
  }          

}); 

</script> 
</html>
